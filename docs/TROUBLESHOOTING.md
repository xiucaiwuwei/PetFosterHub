# PetFosterHub 故障排除指南

## 概述

本指南旨在帮助用户和开发者解决在使用或开发PetFosterHub过程中可能遇到的常见问题。如果您遇到了本指南中未涵盖的问题，请在GitHub上创建一个Issue或者联系项目维护团队。

## 后端服务问题

### 1. 服务无法启动

**症状**：Spring Boot应用无法正常启动，控制台显示错误信息。

**可能原因及解决方案**：

- **端口被占用**
  - 错误信息：`Address already in use`
  - 解决方案：检查`application.yml`文件中的`server.port`配置，修改为未被占用的端口；或关闭占用该端口的其他应用。
  
- **数据库连接失败**
  - 错误信息：`Cannot connect to database`或`Connection refused`
  - 解决方案：检查数据库服务是否运行；验证`application.yml`中的数据库连接配置（URL、用户名、密码）是否正确；检查数据库防火墙设置。
  
- **Redis连接失败**
  - 错误信息：`Cannot connect to Redis`
  - 解决方案：检查Redis服务是否运行；验证Redis连接配置是否正确；检查Redis防火墙设置。
  
- **依赖冲突**
  - 错误信息：`NoSuchMethodError`、`ClassNotFoundException`或`ClassCastException`
  - 解决方案：检查Maven依赖是否存在冲突；使用`mvn dependency:tree`命令分析依赖树，排除冲突的依赖。

### 2. API接口调用失败

**症状**：调用API接口时返回错误状态码或异常信息。

**可能原因及解决方案**：

- **认证失败**
  - 状态码：401 Unauthorized
  - 解决方案：确保请求头中包含有效的JWT令牌；检查令牌是否过期；验证用户权限是否足够。
  
- **请求参数错误**
  - 状态码：400 Bad Request
  - 解决方案：检查请求参数是否符合API要求；查看错误信息中详细的参数验证失败原因。
  
- **资源不存在**
  - 状态码：404 Not Found
  - 解决方案：检查请求的URL是否正确；确认请求的资源是否存在。
  
- **服务器内部错误**
  - 状态码：500 Internal Server Error
  - 解决方案：查看服务器日志，定位具体错误原因；检查数据库操作是否正确；查看是否有未处理的异常。
  
- **请求限流**
  - 状态码：429 Too Many Requests
  - 解决方案：减少API调用频率；等待一段时间后再重试；考虑优化代码减少不必要的API调用。

### 3. 数据库操作异常

**症状**：数据库操作时出现异常，如查询、插入、更新或删除失败。

**可能原因及解决方案**：

- **SQL语法错误**
  - 错误信息：`SQLSyntaxErrorException`
  - 解决方案：检查SQL语句是否正确；确保表名、列名与数据库结构一致。
  
- **数据约束违反**
  - 错误信息：`ConstraintViolationException`
  - 解决方案：检查是否违反了数据库约束（如主键冲突、外键约束、唯一约束等）；确保输入数据符合约束要求。
  
- **事务回滚**
  - 错误信息：`Transaction rolled back`
  - 解决方案：查看事务中执行的操作是否有异常；检查业务逻辑是否正确；考虑调整事务隔离级别。

## 前端应用问题

### 1. 前端页面加载失败

**症状**：浏览器中无法正常加载前端页面，或页面显示不完整。

**可能原因及解决方案**：

- **依赖未安装**
  - 错误信息：控制台显示模块找不到或函数未定义
  - 解决方案：在前端目录中执行`npm install`命令，安装所有依赖。
  
- **编译错误**
  - 错误信息：`npm run dev`或`npm run build`时出现编译错误
  - 解决方案：根据错误信息修复代码中的语法错误或类型错误；检查TypeScript类型定义是否正确。
  
- **网络问题**
  - 症状：页面资源加载缓慢或失败
  - 解决方案：检查网络连接；确认CDN服务是否正常；检查防火墙设置。

### 2. 页面交互异常

**症状**：页面可以加载，但点击按钮、填写表单等交互操作无法正常工作。

**可能原因及解决方案**：

- **JavaScript错误**
  - 症状：控制台显示JavaScript错误
  - 解决方案：根据错误信息定位并修复代码问题；检查事件处理函数是否正确绑定。
  
- **API请求失败**
  - 症状：操作无响应或显示错误提示
  - 解决方案：使用浏览器开发者工具查看网络请求；检查API返回状态码和错误信息；确认后端服务是否正常运行。
  
- **状态管理问题**
  - 症状：页面状态显示不正确或更新不及时
  - 解决方案：检查React状态管理逻辑；确保组件正确接收和更新props；验证Redux（如使用）状态更新是否正常。

### 3. 跨域问题

**症状**：控制台显示跨域错误，API请求被浏览器阻止。

**可能原因及解决方案**：

- **后端未配置CORS**
  - 错误信息：`Access to XMLHttpRequest at 'xxx' from origin 'xxx' has been blocked by CORS policy`
  - 解决方案：检查后端是否正确配置了CORS（跨域资源共享）；确保允许前端域名的请求。
  
- **代理配置错误**
  - 症状：开发环境中API请求失败
  - 解决方案：检查前端项目中的代理配置；确保代理服务器正确转发请求到后端服务。

## Docker部署问题

### 1. Docker容器无法启动

**症状**：执行`docker-compose up -d`后，某些容器无法正常启动。

**可能原因及解决方案**：

- **镜像拉取失败**
  - 错误信息：`pull access denied`或`image not found`
  - 解决方案：检查`docker-compose.yml`中的镜像名称是否正确；确认是否有足够的网络权限拉取镜像。
  
- **容器配置错误**
  - 错误信息：各种启动错误
  - 解决方案：使用`docker logs 容器名称`查看容器日志；检查`docker-compose.yml`中的配置是否正确。
  
- **端口冲突**
  - 错误信息：`port is already allocated`
  - 解决方案：修改`docker-compose.yml`中的端口映射配置；关闭占用相同端口的其他应用或容器。
  
- **资源不足**
  - 症状：容器频繁重启或无法启动
  - 解决方案：检查系统资源（CPU、内存、磁盘空间）是否充足；考虑调整Docker资源限制。

### 2. 容器间通信问题

**症状**：Docker容器之间无法正常通信。

**可能原因及解决方案**：

- **网络配置错误**
  - 症状：服务无法连接到数据库或其他服务
  - 解决方案：检查`docker-compose.yml`中的网络配置；确保所有需要通信的容器都在同一个网络中。
  
- **服务发现问题**
  - 症状：使用服务名称无法解析到正确的容器IP
  - 解决方案：确认服务名称是否正确；检查Docker网络设置；尝试使用容器IP进行连接测试。

### 3. 数据持久化问题

**症状**：重启容器后，数据丢失或无法访问。

**可能原因及解决方案**：

- **数据卷未正确挂载**
  - 症状：容器重启后数据丢失
  - 解决方案：检查`docker-compose.yml`中的数据卷挂载配置；确认主机目录是否存在且有正确的权限。
  
- **权限问题**
  - 错误信息：`Permission denied`
  - 解决方案：检查主机目录和容器内目录的权限设置；确保容器进程有足够的权限访问数据卷。

## 日志分析

### 1. 后端日志

后端日志默认存储在`backend/logs`目录下。您可以使用以下命令查看日志：

```bash
cd backend
cat logs/app.log
```

常见的日志级别有：ERROR（错误）、WARN（警告）、INFO（信息）、DEBUG（调试）、TRACE（跟踪）。

### 2. 前端日志

前端日志可以通过浏览器开发者工具的控制台查看。在Chrome浏览器中，可以按F12键打开开发者工具，切换到"Console"标签页查看日志。

### 3. Docker容器日志

可以使用以下命令查看Docker容器的日志：

```bash
docker logs 容器名称
```

## 常见错误及解决方案速查表

| 错误现象 | 可能原因 | 解决方案 |
|---------|---------|---------|
| 服务无法启动，端口被占用 | 端口冲突 | 修改`application.yml`中的`server.port`配置 |
| 数据库连接失败 | 数据库服务未启动或配置错误 | 检查数据库服务状态和连接配置 |
| API返回401错误 | 认证失败 | 确保请求包含有效的JWT令牌 |
| 前端编译错误 | 代码语法错误或依赖问题 | 修复代码错误，执行`npm install` |
| Docker容器启动失败 | 镜像问题或配置错误 | 查看容器日志，检查配置 |
| 跨域错误 | CORS配置问题 | 检查后端CORS配置 |

## 获取更多帮助

如果您在排查问题时需要更多帮助，可以通过以下途径获取支持：

1. 查看项目的[GitHub Issues](https://github.com/项目地址/issues)，查找是否有类似问题的解决方案
2. 在GitHub上创建新的Issue，详细描述您遇到的问题
3. 联系项目维护团队：team@petfosterhub.com

## 提交问题报告

当您需要提交问题报告时，请提供以下信息以帮助我们更好地理解和解决问题：

1. **环境信息**：操作系统、Java版本、Node.js版本、浏览器版本等
2. **问题描述**：详细描述您遇到的问题现象
3. **重现步骤**：清晰的步骤，使我们能够重现问题
4. **错误日志**：相关的错误日志和错误信息
5. **预期行为**：描述您期望看到的正确行为
6. **相关截图**：如果适用，请提供相关截图

提供越详细的信息，我们就能越快地帮助您解决问题。