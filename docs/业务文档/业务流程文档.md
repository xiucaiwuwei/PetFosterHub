# PetFosterHub 业务流程文档

## 1. 概述

本文档详细描述了PetFosterHub系统的核心业务流程，包括用户注册、宠物管理、寄养服务发布、订单创建与支付、评价反馈等流程，为系统的业务逻辑实现提供详细指导，也为毕业设计论文提供业务流程的详细说明。

## 2. 角色定义

系统涉及以下主要角色：

1. **宠物主人**：拥有宠物并需要寄养服务的用户
2. **寄养家庭**：提供宠物寄养服务的用户
3. **管理员**：负责系统管理和维护的用户

## 3. 核心业务流程

### 3.1 用户注册与登录流程

**功能说明**：用户（宠物主人或寄养家庭）注册账户并登录系统

**流程图**：

```
开始
  |
  ├─> 用户访问注册页面
  |     |
  |     ├─> 填写注册信息（用户名、密码、邮箱、电话、角色）
  |     |
  |     ├─> 提交注册请求
  |     |
  |     ├─> 系统验证信息并创建用户
  |     |
  |     ├─> 发送验证邮件/短信
  |     |
  |     └─> 注册成功
  |
  ├─> 用户访问登录页面
  |     |
  |     ├─> 输入用户名和密码
  |     |
  |     ├─> 提交登录请求
  |     |
  |     ├─> 系统验证凭证
  |     |
  |     ├─> 生成JWT令牌
  |     |
  |     └─> 登录成功，跳转到首页
  |
结束
```

**关键环节**：
- 用户信息验证：确保用户名、邮箱、电话的唯一性
- 密码加密存储：使用BCrypt算法加密用户密码
- 邮箱/手机验证：发送验证码进行身份验证
- JWT令牌生成：用于后续请求的身份认证

### 3.2 宠物信息管理流程

**功能说明**：宠物主人添加、修改、查询和删除宠物信息

**流程图**：

```
开始
  |
  ├─> 宠物主人登录系统
  |     |
  |     ├─> 进入宠物管理页面
  |     |
  |     ├─> 选择操作类型（添加/修改/查询/删除）
  |     |
  |     ├─> 根据操作类型执行相应操作
  |     |    |
  |     |    ├─> 添加：填写宠物信息，上传照片
  |     |    |
  |     |    ├─> 修改：选择宠物，修改信息
  |     |    |
  |     |    ├─> 查询：查看宠物列表和详情
  |     |    |
  |     |    └─> 删除：选择宠物，确认删除
  |     |
  |     ├─> 系统处理请求
  |     |
  |     └─> 操作成功提示
  |
结束
```

**关键环节**：
- 权限验证：确保只有宠物主人才可管理自己的宠物
- 信息完整性校验：确保宠物基本信息完整
- 图片上传处理：支持宠物照片的上传和存储

### 3.3 寄养服务发布流程

**功能说明**：寄养家庭发布可提供的寄养服务信息

**流程图**：

```
开始
  |
  ├─> 寄养家庭登录系统
  |     |
  |     ├─> 进入寄养服务管理页面
  |     |
  |     ├─> 点击"发布新服务"
  |     |
  |     ├─> 填写服务信息（标题、描述、价格、地点、可服务时间、可接受宠物类型等）
  |     |
  |     ├─> 上传服务相关照片
  |     |
  |     ├─> 提交发布请求
  |     |
  |     ├─> 系统验证信息并创建服务
  |     |
  |     └─> 服务发布成功，状态为"可预订"
  |
结束
```

**关键环节**：
- 权限验证：确保只有寄养家庭角色才能发布服务
- 服务信息完整性：确保服务描述、价格、时间等信息完整
- 服务状态管理：新发布的服务状态为"可预订"

### 3.4 寄养服务预订流程

**功能说明**：宠物主人搜索并预订寄养服务

**流程图**：

```
开始
  |
  ├─> 宠物主人登录系统
  |     |
  |     ├─> 进入寄养服务搜索页面
  |     |
  |     ├─> 输入搜索条件（位置、时间、宠物类型等）
  |     |
  |     ├─> 系统展示符合条件的寄养服务列表
  |     |
  |     ├─> 浏览服务详情，选择合适的服务
  |     |
  |     ├─> 点击"立即预订"
  |     |
  |     ├─> 选择需要寄养的宠物
  |     |
  |     ├─> 确认寄养时间和价格
  |     |
  |     ├─> 提交预订请求
  |     |
  |     ├─> 系统创建订单，状态为"待确认"
  |     |
  |     └─> 预订成功提示
  |
结束
```

**关键环节**：
- 服务可用性检查：确保所选服务在预订时间内可用
- 价格计算：根据寄养时间和服务单价计算订单总价
- 订单状态初始化：新创建的订单状态为"待确认"

### 3.5 订单确认与支付流程

**功能说明**：寄养家庭确认订单，宠物主人完成支付

**流程图**：

```
开始
  |
  ├─> 寄养家庭收到新订单通知
  |     |
  |     ├─> 查看订单详情
  |     |
  |     ├─> 选择确认或拒绝订单
  |     |    |
  |     |    ├─> 拒绝：填写拒绝原因，订单状态变为"已拒绝"
  |     |    |
  |     |    └─> 确认：订单状态变为"已确认"
  |     |
  |     └─> 系统通知宠物主人订单状态变更
  |
  ├─> 宠物主人收到订单确认通知
  |     |
  |     ├─> 进入订单详情页面
  |     |
  |     ├─> 点击"立即支付"
  |     |
  |     ├─> 选择支付方式
  |     |
  |     ├─> 跳转至支付平台完成支付
  |     |
  |     ├─> 支付平台回调通知系统支付结果
  |     |
  |     ├─> 系统更新订单状态为"已支付"
  |     |
  |     └─> 支付成功提示
  |
结束
```

**关键环节**：
- 订单状态流转：待确认 -> 已确认/已拒绝 -> 已支付
- 支付安全：确保支付过程的安全性和可靠性
- 支付结果通知：通过回调机制及时获取支付结果

### 3.6 服务评价流程

**功能说明**：寄养服务完成后，用户进行评价和反馈

**流程图**：

```
开始
  |
  ├─> 寄养服务结束
  |     |
  |     ├─> 系统自动将订单状态更新为"已完成"
  |     |
  |     ├─> 系统向双方用户发送评价提醒
  |     |
  |     ├─> 用户登录系统，进入订单详情页面
  |     |
  |     ├─> 点击"评价服务"
  |     |
  |     ├─> 选择评分（1-5星）
  |     |
  |     ├─> 填写评价内容
  |     |
  |     ├─> 提交评价
  |     |
  |     ├─> 系统保存评价信息
  |     |
  |     ├─> 更新服务的平均评分
  |     |
  |     └─> 评价成功提示
  |
结束
```

**关键环节**：
- 评价时机：只有已完成的订单才能进行评价
- 双向评价：宠物主人和寄养家庭可以互相评价
- 评分计算：根据用户评价更新服务的平均评分

### 3.7 消息通信流程

**功能说明**：用户之间进行消息交流和沟通

**流程图**：

```
开始
  |
  ├─> 用户登录系统
  |     |
  |     ├─> 进入消息中心或订单详情页
  |     |
  |     ├─> 选择消息接收方或关联订单
  |     |
  |     ├─> 输入消息内容
  |     |
  |     ├─> 点击"发送"
  |     |
  |     ├─> 系统保存消息记录
  |     |
  |     ├─> 系统推送消息通知给接收方
  |     |
  |     └─> 消息发送成功
  |
  ├─> 接收方用户收到消息通知
  |     |
  |     ├─> 查看新消息
  |     |
  |     ├─> 系统更新消息状态为"已读"
  |     |
  |     └─> 可选择回复消息
  |
结束
```

**关键环节**：
- 消息存储：所有消息记录保存在数据库中
- 消息通知：使用WebSocket或推送服务实时通知新消息
- 消息状态管理：记录消息的已读/未读状态

## 4. 业务规则与约束

1. **用户角色约束**：
   - 一个用户只能拥有一种主要角色（宠物主人或寄养家庭）
   - 管理员角色具有最高权限，可以管理所有系统资源

2. **订单状态流转规则**：
   - 订单只能按照指定的状态流转路径进行变更
   - 已完成或已取消的订单不能再进行状态变更

3. **支付规则**：
   - 订单确认后才能进行支付
   - 支付超时订单自动取消
   - 支持部分退款和全额退款

4. **评价规则**：
   - 每个订单只能评价一次
   - 评价提交后不可修改，但可以删除
   - 系统对评价内容进行审核，过滤不当内容

5. **服务发布规则**：
   - 寄养家庭必须完成实名认证才能发布服务
   - 服务信息必须真实完整，不得发布虚假信息
   - 服务价格必须合理，不得恶意低价竞争或高价宰客

## 5. 异常处理流程

### 5.1 支付失败处理

- 用户支付失败后，系统提示用户重新支付
- 支付超时未完成，系统自动取消订单
- 对于支付异常情况，系统记录日志并通知管理员处理

### 5.2 订单取消流程

- 宠物主人在订单确认前可以自由取消订单
- 订单确认后取消，需双方协商并可能产生违约金
- 系统根据取消原因和时间计算退款金额

### 5.3 服务纠纷处理

- 用户可以发起服务纠纷申诉
- 管理员介入调查并进行仲裁
- 根据仲裁结果进行订单状态和退款处理

## 6. 附录：业务流程表格汇总

| 业务流程 | 参与角色 | 关键环节 | 系统操作 |
|---------|---------|---------|---------|
| 用户注册与登录 | 所有用户 | 信息验证、密码加密、JWT生成 | 创建用户、验证凭证、生成令牌 |
| 宠物信息管理 | 宠物主人 | 权限验证、信息校验、图片处理 | CRUD宠物信息 |
| 寄养服务发布 | 寄养家庭 | 权限验证、信息完整性、状态管理 | 创建寄养服务 |
| 寄养服务预订 | 宠物主人 | 服务可用性、价格计算、状态初始化 | 创建订单 |
| 订单确认与支付 | 寄养家庭、宠物主人 | 状态流转、支付安全、结果通知 | 更新订单状态、处理支付 |
| 服务评价 | 所有用户 | 评价时机、双向评价、评分计算 | 保存评价、更新评分 |
| 消息通信 | 所有用户 | 消息存储、通知推送、状态管理 | 保存消息、推送通知 |

通过以上业务流程的详细设计，PetFosterHub系统能够高效地支持宠物寄养服务的全流程管理，为用户提供便捷、可靠的服务体验。