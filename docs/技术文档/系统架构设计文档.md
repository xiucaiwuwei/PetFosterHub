# PetFosterHub 系统架构设计文档

## 1. 架构概述

PetFosterHub宠物寄养平台采用分层架构设计，旨在构建一个高可用、高性能、可扩展的综合性宠物寄养服务平台。本文档详细介绍了系统的整体架构设计、技术选型、各层设计和关键组件等内容，为系统的开发和维护提供技术指导。

### 1.1 架构设计原则

系统架构设计遵循以下原则：
- **高可用性**：确保系统能够7×24小时稳定运行，提供可靠的服务
- **高性能**：优化系统响应速度和并发处理能力，提供良好的用户体验
- **可扩展性**：支持功能扩展和横向扩展，以适应未来业务发展的需求
- **安全性**：采取多层次的安全防护措施，保障系统和用户数据的安全
- **可维护性**：代码结构清晰，模块划分合理，便于系统的维护和升级
- **可测试性**：设计易于测试的系统组件和接口，确保系统质量

### 1.2 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                             客户端层                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌──────────────────────────────────┐ │
│  │   Web端     │  │  移动端APP  │  │    第三方系统集成                │ │
│  │ (Vue.js)    │  │ (Flutter)   │  │                                 │ │
│  └─────────────┘  └─────────────┘  └──────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                             接入层                                      │
│  ┌─────────────┐  ┌─────────────┐  ┌──────────────────────────────────┐ │
│  │  负载均衡器 │  │  API网关    │  │    安全认证中心                  │ │
│  │ (Nginx)     │  │            │  │ (JWT认证、OAuth2.0)              │ │
│  └─────────────┘  └─────────────┘  └──────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                             应用层                                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ 用户服务    │  │ 宠物服务    │  │ 寄养服务    │  │ 订单服务    │     │
│  │ (User)      │  │ (Pet)       │  │ (Foster)    │  │ (Order)     │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ 消息服务    │  │ 支付服务    │  │ 评价服务    │  │ 搜索服务    │     │
│  │ (Message)   │  │ (Payment)   │  │ (Review)    │  │ (Search)    │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                             数据层                                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ MySQL数据库 │  │ Redis缓存   │  │ 文件存储    │  │ 搜索引擎    │     │
│  │ (业务数据)  │  │ (热点数据)  │  │ (图片、视频)│  │ (Elasticsearch)│  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           基础设施层                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ 服务器集群  │  │ 网络设备    │  │ 存储设备    │  │ 监控系统    │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
```

## 2. 技术栈选型

### 2.1 后端技术栈

- **框架**：Spring Boot 2.7.x
  - 提供了快速构建独立Spring应用的能力
  - 内嵌Tomcat等Web服务器，简化部署
  - 提供自动配置和starter依赖，简化开发

- **ORM框架**：MyBatis-Plus 3.x
  - 基于MyBatis的增强工具，提供了强大的CRUD操作
  - 支持Lambda表达式、链式调用等特性，简化代码
  - 内置分页插件、性能分析插件等实用功能

- **数据库**：MySQL 8.0
  - 高性能、稳定的关系型数据库
  - 支持事务、视图、存储过程等高级特性
  - 支持JSON数据类型，便于存储半结构化数据

- **缓存**：Redis 6.0
  - 高性能的内存数据结构存储系统
  - 支持多种数据结构，如字符串、列表、集合、哈希等
  - 提供发布订阅、事务、Lua脚本等高级功能

- **搜索引擎**：Elasticsearch 7.x
  - 分布式全文搜索引擎，提供快速的搜索能力
  - 支持复杂的查询条件和聚合分析
  - 良好的扩展性和高可用性

- **消息队列**：RabbitMQ
  - 可靠的消息传递系统，支持多种消息协议
  - 提供消息确认、死信队列等高级特性
  - 支持集群部署，保证高可用性

- **认证授权**：Spring Security + JWT
  - 提供全面的安全解决方案
  - 支持基于角色的访问控制（RBAC）
  - 使用JWT实现无状态认证

- **日志框架**：SLF4J + Logback
  - 提供统一的日志接口
  - 支持多种日志级别和输出格式
  - 便于日志管理和分析

- **API文档**：Swagger/OpenAPI
  - 自动生成REST API文档
  - 支持在线API测试
  - 便于前后端协作开发

### 2.2 前端技术栈

- **框架**：Vue.js 3.x + Vite
  - 渐进式JavaScript框架，易于上手
  - 组件化开发，提高代码复用性
  - Vite提供快速的开发构建体验

- **状态管理**：Pinia
  - 轻量级的状态管理库
  - 支持TypeScript，提供良好的类型提示
  - 简化组件间的数据共享和通信

- **UI组件库**：Element Plus
  - 基于Vue 3的组件库
  - 提供丰富的UI组件和交互效果
  - 支持自定义主题

- **路由**：Vue Router 4.x
  - 客户端路由管理
  - 支持嵌套路由、路由守卫等高级特性
  - 便于构建单页应用（SPA）

- **HTTP客户端**：Axios
  - 基于Promise的HTTP客户端
  - 支持请求拦截、响应拦截、错误处理等
  - 提供取消请求、自动转换JSON数据等功能

- **图表库**：ECharts
  - 功能丰富的图表库
  - 支持多种图表类型和交互方式
  - 良好的兼容性和性能

### 2.3 移动端技术栈

- **框架**：Flutter 3.x
  - 跨平台移动应用开发框架
  - 使用Dart语言开发，一次编写，多平台运行
  - 提供丰富的UI组件和性能优化

- **状态管理**：Provider + GetX
  - 轻量级的状态管理解决方案
  - 支持依赖注入，简化组件间通信
  - GetX提供导航、国际化等实用功能

### 2.4 基础设施与部署

- **容器化**：Docker
  - 提供标准化的应用打包和部署方式
  - 简化环境配置和依赖管理
  - 支持快速扩缩容

- **容器编排**：Kubernetes
  - 自动化容器部署、扩展和管理
  - 提供负载均衡、服务发现等功能
  - 保证应用的高可用性

- **CI/CD**：Jenkins + GitLab CI
  - 实现持续集成和持续部署
  - 自动化构建、测试和部署流程
  - 提高开发效率和代码质量

- **监控系统**：Prometheus + Grafana
  - 监控系统性能和健康状况
  - 提供丰富的指标收集和可视化功能
  - 支持告警配置，及时发现问题

## 3. 系统分层设计

### 3.1 接入层

接入层是系统的门户，负责接收客户端请求并进行初步处理，主要包括以下组件：

1. **负载均衡器**：使用Nginx作为负载均衡器，将请求分发到多个应用服务器，提高系统的吞吐量和可用性
2. **API网关**：统一管理API接口，提供路由转发、请求过滤、限流控制等功能
3. **安全认证中心**：负责用户身份认证和授权，支持JWT和OAuth2.0协议

接入层的主要职责包括：
- 接收和分发客户端请求
- 进行身份认证和权限校验
- 实现请求限流和熔断
- 记录请求日志

### 3.2 应用层

应用层是系统的核心，负责业务逻辑的处理和实现，采用微服务架构设计，将系统拆分为多个独立的服务模块：

1. **用户服务**：负责用户注册、登录、个人信息管理、实名认证等功能
2. **宠物服务**：负责宠物信息的添加、编辑、删除、查询等功能
3. **寄养服务**：负责寄养服务的发布、管理、搜索、预约等功能
4. **订单服务**：负责订单的创建、支付、状态更新、查询等功能
5. **消息服务**：负责即时通讯、系统通知、消息管理等功能
6. **支付服务**：负责支付对接、交易处理、资金结算等功能
7. **评价服务**：负责服务评价的提交、查看、管理等功能
8. **搜索服务**：负责提供全文搜索、高级筛选等功能

应用层的主要职责包括：
- 实现业务逻辑处理
- 进行数据校验和转换
- 调用数据层进行数据操作
- 与其他服务进行通信

### 3.3 数据层

数据层负责数据的存储、访问和管理，主要包括以下组件：

1. **MySQL数据库**：存储系统的核心业务数据，如用户数据、宠物数据、订单数据等
2. **Redis缓存**：缓存热点数据，提高数据访问速度，减轻数据库压力
3. **文件存储**：存储图片、视频等非结构化数据，可使用云存储服务
4. **搜索引擎**：使用Elasticsearch提供全文搜索和高级查询功能

数据层的主要职责包括：
- 数据的存储和读取
- 数据的索引和查询优化
- 数据的缓存和过期管理
- 数据的备份和恢复

### 3.4 基础设施层

基础设施层为系统提供底层的运行环境和支持，主要包括以下组件：

1. **服务器集群**：提供计算资源，支持应用的运行
2. **网络设备**：提供网络连接和通信支持
3. **存储设备**：提供数据存储空间
4. **监控系统**：监控系统的运行状态和性能指标

基础设施层的主要职责包括：
- 提供稳定的运行环境
- 保证系统的可扩展性和高可用性
- 监控系统性能和健康状况
- 进行系统资源管理和优化

## 4. 核心模块设计

### 4.1 用户服务模块

#### 4.1.1 功能概述

用户服务模块负责用户的注册、登录、个人信息管理、实名认证等功能，是系统的基础模块之一。

#### 4.1.2 关键类与接口

- **UserController**：处理用户相关的HTTP请求
- **UserService**：提供用户业务逻辑处理
- **UserMapper**：操作用户数据
- **UserEntity**：用户实体类
- **UserDTO**：用户数据传输对象

#### 4.1.3 数据模型

```java
@Data
public class UserEntity {
    private Long id;                     // 用户ID
    private String username;             // 用户名
    private String password;             // 密码(加密存储)
    private String phone;                // 手机号
    private String email;                // 邮箱
    private String nickname;             // 昵称
    private String avatar;               // 头像
    private Integer gender;              // 性别(0-未知,1-男,2-女)
    private Date birthday;               // 生日
    private Integer userType;            // 用户类型(1-宠物主人,2-寄养家庭)
    private Integer authStatus;          // 认证状态(0-未认证,1-审核中,2-已认证,3-认证失败)
    private String idCard;               // 身份证号(加密存储)
    private String idCardFront;          // 身份证正面照
    private String idCardBack;           // 身份证反面照
    private Date createTime;             // 创建时间
    private Date updateTime;             // 更新时间
    private Integer status;              // 账号状态(0-禁用,1-正常)
}
```

#### 4.1.4 主要流程

1. **用户注册流程**：
   - 接收用户注册请求
   - 验证注册信息（如手机号、邮箱格式）
   - 检查用户名/手机号是否已被注册
   - 对密码进行加密处理
   - 保存用户信息到数据库
   - 返回注册结果

2. **用户登录流程**：
   - 接收用户登录请求
   - 验证用户名和密码
   - 生成JWT令牌
   - 返回登录结果和JWT令牌

3. **实名认证流程**：
   - 接收用户认证请求和认证材料
   - 验证认证材料的完整性和合法性
   - 更新用户认证状态为审核中
   - 异步通知审核人员进行审核
   - 审核完成后更新用户认证状态

### 4.2 宠物服务模块

#### 4.2.1 功能概述

宠物服务模块负责宠物信息的添加、编辑、删除、查询等功能，为寄养服务提供基础数据支持。

#### 4.2.2 关键类与接口

- **PetController**：处理宠物相关的HTTP请求
- **PetService**：提供宠物业务逻辑处理
- **PetMapper**：操作宠物数据
- **PetEntity**：宠物实体类
- **PetDTO**：宠物数据传输对象

#### 4.2.3 数据模型

```java
@Data
public class PetEntity {
    private Long id;                     // 宠物ID
    private Long userId;                 // 所属用户ID
    private String name;                 // 宠物名称
    private String breed;                // 品种
    private Integer type;                // 宠物类型(1-猫,2-狗,3-其他)
    private Integer gender;              // 性别(1-公,2-母)
    private Integer age;                 // 年龄
    private String weight;               // 体重
    private String description;          // 描述
    private String healthCondition;      // 健康状况
    private String vaccineRecords;       // 疫苗接种记录
    private String characterTraits;      // 性格特点
    private String dietHabits;           // 饮食习惯
    private List<String> images;         // 宠物照片
    private Date createTime;             // 创建时间
    private Date updateTime;             // 更新时间
    private Integer status;              // 状态(0-禁用,1-正常)
}
```

#### 4.2.4 主要流程

1. **添加宠物流程**：
   - 接收添加宠物请求和宠物信息
   - 验证宠物信息的完整性和合法性
   - 上传宠物照片到文件存储系统
   - 保存宠物信息到数据库
   - 返回添加结果

2. **查询宠物流程**：
   - 接收查询宠物请求和查询条件
   - 根据查询条件从数据库查询宠物信息
   - 对查询结果进行分页处理
   - 返回查询结果

### 4.3 寄养服务模块

#### 4.3.1 功能概述

寄养服务模块负责寄养服务的发布、管理、搜索、预约等功能，是系统的核心业务模块之一。

#### 4.3.2 关键类与接口

- **FosterServiceController**：处理寄养服务相关的HTTP请求
- **FosterServiceService**：提供寄养服务业务逻辑处理
- **FosterServiceMapper**：操作寄养服务数据
- **FosterServiceEntity**：寄养服务实体类
- **FosterServiceDTO**：寄养服务数据传输对象

#### 4.3.3 数据模型

```java
@Data
public class FosterServiceEntity {
    private Long id;                     // 服务ID
    private Long userId;                 // 发布用户ID
    private String title;                // 服务标题
    private String description;          // 服务描述
    private BigDecimal price;            // 服务价格
    private Integer serviceType;         // 服务类型(1-日托,2-全托,3-临时照顾等)
    private String address;              // 服务地址
    private Double longitude;            // 经度
    private Double latitude;             // 纬度
    private Integer maxCapacity;         // 最大容纳数量
    private String availableTime;        // 可预约时间
    private List<String> facilities;     // 设施列表
    private List<String> images;         // 服务环境照片
    private Double avgRating;            // 平均评分
    private Integer reviewCount;         // 评价数量
    private Integer status;              // 服务状态(0-审核中,1-可预约,2-不可预约,3-已下架)
    private Date createTime;             // 创建时间
    private Date updateTime;             // 更新时间
}
```

#### 4.3.4 主要流程

1. **发布寄养服务流程**：
   - 接收发布服务请求和服务信息
   - 验证服务信息的完整性和合法性
   - 上传服务环境照片到文件存储系统
   - 保存服务信息到数据库，状态设置为审核中
   - 异步通知审核人员进行审核
   - 审核完成后更新服务状态

2. **搜索寄养服务流程**：
   - 接收搜索服务请求和搜索条件
   - 构建Elasticsearch查询条件
   - 调用Elasticsearch进行搜索
   - 对搜索结果进行分页处理
   - 返回搜索结果

### 4.4 订单服务模块

#### 4.4.1 功能概述

订单服务模块负责订单的创建、支付、状态更新、查询等功能，处理系统的核心交易流程。

#### 4.4.2 关键类与接口

- **OrderController**：处理订单相关的HTTP请求
- **OrderService**：提供订单业务逻辑处理
- **OrderMapper**：操作订单数据
- **OrderEntity**：订单实体类
- **OrderDTO**：订单数据传输对象

#### 4.4.3 数据模型

```java
@Data
public class OrderEntity {
    private Long id;                     // 订单ID
    private String orderNo;              // 订单编号
    private Long userId;                 // 下单用户ID
    private Long fosterServiceId;        // 寄养服务ID
    private Long fosterUserId;           // 寄养家庭用户ID
    private List<Long> petIds;           // 宠物ID列表
    private BigDecimal totalAmount;      // 订单总金额
    private Date startDate;              // 开始日期
    private Date endDate;                // 结束日期
    private Integer orderStatus;         // 订单状态(0-待支付,1-已支付,2-进行中,3-已完成,4-已取消,5-已退款)
    private Integer paymentStatus;       // 支付状态(0-未支付,1-已支付)
    private String paymentMethod;        // 支付方式
    private Date paymentTime;            // 支付时间
    private String notes;                // 备注信息
    private Date createTime;             // 创建时间
    private Date updateTime;             // 更新时间
}
```

#### 4.4.4 主要流程

1. **创建订单流程**：
   - 接收创建订单请求和订单信息
   - 验证订单信息的完整性和合法性
   - 检查服务可用性和库存
   - 生成订单编号
   - 保存订单信息到数据库，状态设置为待支付
   - 返回订单创建结果和支付链接

2. **订单支付流程**：
   - 接收支付通知
   - 验证支付信息的真实性和完整性
   - 更新订单状态为已支付
   - 异步通知相关用户订单状态变更
   - 记录支付日志

## 5. 系统安全设计

### 5.1 认证与授权

1. **JWT认证**：采用JWT(JSON Web Token)实现无状态认证，用户登录后生成JWT令牌，后续请求通过令牌进行身份验证
2. **基于角色的访问控制(RBAC)**：实现细粒度的权限控制，根据用户角色分配不同的操作权限
3. **密码安全**：对用户密码进行加盐哈希处理，使用BCrypt等加密算法确保密码安全
4. **多因素认证**：支持手机号、邮箱等多因素认证，提高账号安全性

### 5.2 数据安全

1. **数据加密**：对敏感数据（如用户身份证号、手机号等）进行加密存储和传输
2. **数据脱敏**：在非必要场景下，对敏感数据进行脱敏处理，如显示部分手机号或身份证号
3. **数据备份与恢复**：定期对数据库进行备份，确保数据可恢复性
4. **防SQL注入**：使用参数化查询和ORM框架，防止SQL注入攻击

### 5.3 接口安全

1. **API接口认证**：所有API接口都需要进行身份认证，防止未授权访问
2. **请求频率限制**：对API接口进行请求频率限制，防止恶意攻击和滥用
3. **参数校验**：对所有输入参数进行严格校验，确保参数的合法性和安全性
4. **HTTPS传输**：使用HTTPS协议进行数据传输，确保数据传输过程中的安全性

### 5.4 防攻击设计

1. **XSS防护**：对用户输入进行过滤和转义，防止XSS攻击
2. **CSRF防护**：使用CSRF令牌，防止跨站请求伪造攻击
3. **点击劫持防护**：设置X-Frame-Options响应头，防止点击劫持攻击
4. **敏感操作二次确认**：对敏感操作（如删除、支付等）进行二次确认，防止误操作

## 6. 系统性能优化

### 6.1 数据库优化

1. **索引优化**：为频繁查询的字段创建索引，提高查询性能
2. **查询优化**：优化SQL语句，避免全表扫描，合理使用连接查询
3. **分页优化**：使用高效的分页查询方式，避免大数据量分页时的性能问题
4. **数据库连接池**：配置合理的数据库连接池参数，提高数据库连接的利用率

### 6.2 缓存优化

1. **热点数据缓存**：将频繁访问的热点数据缓存到Redis中，减轻数据库压力
2. **缓存策略**：制定合理的缓存过期策略，确保缓存数据的及时性和一致性
3. **多级缓存**：结合本地缓存和分布式缓存，提高数据访问效率

### 6.3 并发与异步处理

1. **线程池优化**：合理配置线程池参数，提高系统的并发处理能力
2. **异步处理**：将耗时操作（如发送消息、文件处理等）异步化，提高系统响应速度
3. **消息队列**：使用消息队列解耦系统组件，提高系统的扩展性和稳定性

### 6.4 代码优化

1. **避免重复计算**：对计算结果进行缓存，避免重复计算
2. **资源释放**：及时释放数据库连接、文件句柄等资源，避免资源泄漏
3. **懒加载**：对数据加载采用懒加载方式，减少不必要的资源消耗

## 7. 系统扩展性设计

### 7.1 微服务架构

1. **服务拆分**：将系统拆分为多个独立的微服务，每个服务负责特定的业务功能
2. **服务注册与发现**：使用服务注册与发现机制（如Eureka、Nacos），实现服务的自动注册和发现
3. **服务通信**：采用RESTful API或消息队列进行服务间通信
4. **服务网关**：使用API网关统一管理和路由服务请求

### 7.2 水平扩展

1. **无状态设计**：服务设计为无状态，便于水平扩展
2. **负载均衡**：使用负载均衡器（如Nginx、Ribbon）将请求分发到多个服务实例
3. **数据库分库分表**：当数据量达到一定规模时，考虑数据库分库分表，提高数据库的扩展性

### 7.3 插件化设计

1. **接口抽象**：对系统功能进行接口抽象，便于功能扩展和替换
2. **事件驱动**：采用事件驱动架构，通过事件触发和处理实现系统功能的扩展
3. **插件机制**：设计插件机制，支持第三方功能的接入和扩展

## 8. 总结

PetFosterHub宠物寄养平台的系统架构设计采用了分层架构和微服务架构，充分考虑了系统的高可用性、高性能、可扩展性和安全性。通过合理的技术选型和架构设计，为系统的开发和维护提供了清晰的指导。

本架构设计文档详细介绍了系统的整体架构、技术栈选型、各层设计和关键组件等内容，为毕业设计论文提供了重要的技术支持和参考依据。在系统的开发过程中，我们将严格按照本架构设计文档进行实施，确保系统的质量和性能达到设计要求。