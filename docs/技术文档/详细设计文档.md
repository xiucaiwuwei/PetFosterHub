# PetFosterHub 详细设计文档

## 1. 概述

本文档详细描述了PetFosterHub系统的模块设计、接口设计和数据结构设计，为系统的具体实现提供详细指导，也为毕业设计论文提供技术实现的详细说明。

## 2. 系统架构设计

### 2.1 整体架构

系统采用前后端分离的架构设计，主要分为以下几个层次：

1. **表现层（前端）**：React单页应用，负责用户界面和交互逻辑
2. **API网关层**：处理请求路由、负载均衡、安全认证等
3. **业务逻辑层**：实现核心业务功能和业务规则
4. **数据访问层**：负责与数据库交互，执行数据CRUD操作
5. **数据存储层**：包括MySQL主数据库和Redis缓存

### 2.2 技术选型

| 类别 | 技术/框架 | 版本 | 用途 |
|------|-----------|------|------|
| 后端语言 | Java | 21 | 主要开发语言 |
| 后端框架 | Spring Boot | 3.x | 应用开发框架 |
| 安全框架 | Spring Security | 6.x | 认证和授权 |
| 持久层 | Spring Data JPA | 3.x | 数据访问 |
| 缓存 | Redis | 6.x | 高性能缓存 |
| 数据库 | MySQL | 8.x | 主数据库 |
| 前端框架 | React | 18 | 用户界面 |
| 前端语言 | TypeScript | 5.x | 前端开发语言 |
| 构建工具 | Vite | 4.x | 前端构建 |
| 样式框架 | Tailwind CSS | 3.x | UI样式 |

## 3. 核心模块详细设计

### 3.1 用户管理模块

#### 3.1.1 功能描述

用户管理模块负责用户的注册、登录、个人信息管理等功能，包括宠物主人和寄养家庭两种主要角色。

#### 3.1.2 类图设计

```
User (实体类)
├── userId: Long
├── username: String
├── password: String (加密存储)
├── email: String
├── phone: String
├── role: String (OWNER, FOSTER, ADMIN)
├── avatar: String
├── createTime: LocalDateTime
├── updateTime: LocalDateTime
└── status: Integer

UserService (服务接口)
├── register(UserDTO): UserDTO
├── login(LoginDTO): JwtToken
├── updateUserInfo(UserDTO): UserDTO
├── getUserInfo(Long): UserDTO
└── changePassword(PasswordDTO): Boolean
```

#### 3.1.3 主要接口

- POST /api/users/register - 用户注册
- POST /api/users/login - 用户登录
- GET /api/users/me - 获取当前用户信息
- PUT /api/users/me - 更新用户信息
- PUT /api/users/me/password - 修改密码

### 3.2 宠物管理模块

#### 3.2.1 功能描述

宠物管理模块负责宠物信息的录入、修改、查询和删除等功能，包括宠物基本信息、健康记录、特殊需求等。

#### 3.2.2 类图设计

```
Pet (实体类)
├── petId: Long
├── ownerId: Long (关联用户)
├── name: String
├── type: String
├── breed: String
├── age: Integer
├── gender: String
├── weight: Double
├── description: String
├── healthStatus: String
├── specialNeeds: String
└── images: List<String>

PetService (服务接口)
├── addPet(PetDTO): PetDTO
├── updatePet(PetDTO): PetDTO
├── getPetById(Long): PetDTO
├── getPetsByOwnerId(Long): List<PetDTO>
└── deletePet(Long): Boolean
```

#### 3.2.3 主要接口

- POST /api/pets - 添加宠物信息
- GET /api/pets - 获取宠物列表
- GET /api/pets/{id} - 获取宠物详情
- PUT /api/pets/{id} - 更新宠物信息
- DELETE /api/pets/{id} - 删除宠物信息

### 3.3 寄养服务模块

#### 3.3.1 功能描述

寄养服务模块负责寄养服务的发布、搜索、申请和接单等功能，是平台的核心业务模块。

#### 3.3.2 类图设计

```
FosterService (实体类)
├── serviceId: Long
├── fosterId: Long (关联寄养家庭)
├── title: String
├── description: String
├── price: BigDecimal
├── location: String
├── availableStartTime: LocalDateTime
├── availableEndTime: LocalDateTime
├── capacity: Integer
├── petTypes: List<String>
├── status: String (AVAILABLE, BOOKED, CLOSED)
└── rating: Double

FosterServiceService (服务接口)
├── createService(FosterServiceDTO): FosterServiceDTO
├── updateService(FosterServiceDTO): FosterServiceDTO
├── getServiceById(Long): FosterServiceDTO
├── searchServices(SearchCriteria): Page<FosterServiceDTO>
└── updateServiceStatus(Long, String): Boolean
```

#### 3.3.3 主要接口

- POST /api/foster-services - 创建寄养服务
- GET /api/foster-services - 搜索寄养服务
- GET /api/foster-services/{id} - 获取服务详情
- PUT /api/foster-services/{id} - 更新服务信息
- PATCH /api/foster-services/{id}/status - 更新服务状态

### 3.4 订单管理模块

#### 3.4.1 功能描述

订单管理模块负责处理寄养服务的预订、支付、确认等流程，管理订单的全生命周期。

#### 3.4.2 类图设计

```
Booking (实体类)
├── bookingId: Long
├── serviceId: Long (关联寄养服务)
├── ownerId: Long (关联宠物主人)
├── petId: Long (关联宠物)
├── startTime: LocalDateTime
├── endTime: LocalDateTime
├── totalPrice: BigDecimal
├── status: String (PENDING, CONFIRMED, PAID, COMPLETED, CANCELLED)
├── createTime: LocalDateTime
└── updateTime: LocalDateTime

BookingService (服务接口)
├── createBooking(BookingDTO): BookingDTO
├── getBookingById(Long): BookingDTO
├── getBookingsByUser(Long, String): List<BookingDTO>
├── updateBookingStatus(Long, String): Boolean
└── cancelBooking(Long): Boolean
```

#### 3.4.3 主要接口

- POST /api/bookings - 创建订单
- GET /api/bookings - 获取订单列表
- GET /api/bookings/{id} - 获取订单详情
- PATCH /api/bookings/{id}/status - 更新订单状态
- DELETE /api/bookings/{id} - 取消订单

## 4. 数据库设计

### 4.1 数据库表结构

系统主要包含以下数据表：

1. **users** - 用户信息表
2. **pets** - 宠物信息表
3. **foster_services** - 寄养服务信息表
4. **bookings** - 订单信息表
5. **payments** - 支付信息表
6. **reviews** - 评价信息表
7. **messages** - 消息信息表
8. **file_uploads** - 文件上传表
9. **audit_log** - 审计日志表

### 4.2 数据库关系图

```
users 1--N pets
users 1--N foster_services
users 1--N bookings (作为宠物主人)
foster_services 1--N bookings
pets 1--N bookings
bookings 1--1 payments
bookings 1--1 reviews
users 1--N messages (发送方)
users 1--N messages (接收方)
users 1--N file_uploads
```

## 5. API设计规范

### 5.1 RESTful API设计原则

- 使用HTTP方法表示操作类型（GET/POST/PUT/DELETE/PATCH）
- 使用名词表示资源（复数形式）
- 使用状态码表示响应结果
- 使用JSON作为数据交换格式
- 版本化API（/api/v1/...）

### 5.2 请求与响应格式

**请求格式**：
```json
{
  "field1": "value1",
  "field2": "value2",
  "field3": {
    "nestedField1": "value3"
  }
}
```

**成功响应格式**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    // 响应数据
  }
}
```

**错误响应格式**：
```json
{
  "code": 400,
  "message": "error message",
  "error": "error details"
}
```

## 6. 安全设计

### 6.1 认证与授权

- 使用JWT进行用户认证
- 基于角色的访问控制（RBAC）
- 密码加密存储（BCrypt）
- 接口权限验证

### 6.2 数据安全

- 敏感数据加密传输（HTTPS）
- 数据脱敏处理
- SQL注入防护
- XSS攻击防护

## 7. 性能优化

### 7.1 缓存策略

- 使用Redis缓存热点数据
- 实现多级缓存机制
- 缓存过期策略设计

### 7.2 数据库优化

- 合理设计索引
- 优化查询语句
- 分表分库策略（预留）

### 7.3 接口优化

- 响应数据压缩
- 分页查询
- 异步处理耗时操作

## 8. 部署架构

系统采用Docker容器化部署，主要包括以下组件：

1. **前端容器**：Nginx服务，部署React应用
2. **后端容器**：Spring Boot应用
3. **数据库容器**：MySQL服务
4. **缓存容器**：Redis服务
5. **监控容器**：Prometheus和Grafana

使用Docker Compose管理多容器应用，实现一键部署和服务编排。