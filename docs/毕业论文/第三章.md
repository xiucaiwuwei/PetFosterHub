# 3□系统架构设计

系统架构设计是软件开发过程中的关键环节，它为系统的实现提供了蓝图和框架。本章将对PetFosterHub宠物寄养平台的系统架构进行详细设计，包括架构概述、技术栈选型、系统分层设计、核心模块设计和系统安全设计等方面。

## 3.1□架构概述

PetFosterHub宠物寄养平台采用前后端分离的架构设计，将系统分为前端、后端和数据层三个主要部分。前端负责用户界面的展示和交互，后端负责业务逻辑的处理和数据的访问，数据层负责数据的存储和管理。这种架构设计具有以下优点：

1. 前后端解耦：前端和后端可以独立开发、测试和部署，提高开发效率和系统的可维护性。
2. 多端适配：前端可以针对不同的设备和平台（如PC端、移动端、平板端）进行适配，提供一致的用户体验。
3. 性能优化：前端可以利用CDN、缓存等技术进行性能优化，后端可以利用负载均衡、集群等技术提高系统的性能和可用性。
4. 安全性提高：前后端分离可以更好地实施安全策略，如防止XSS攻击、CSRF攻击等。

### 3.1.1□设计原则

在系统架构设计过程中，遵循以下设计原则：

1. 高内聚低耦合：模块内部的功能应高度内聚，模块之间的依赖关系应尽量低耦合，便于模块的独立开发、测试和维护。
2. 可扩展性：系统的架构应具备良好的可扩展性，能够根据业务发展的需要进行横向扩展和纵向扩展。
3. 可靠性：系统应具备高可靠性，确保系统的稳定运行和数据的安全。
4. 性能优化：系统应具备良好的性能，包括响应时间、并发处理能力、吞吐量等方面的优化。
5. 安全性：系统应具备完善的安全机制，确保用户数据的安全和隐私，防止各种网络攻击。
6. 可维护性：系统的架构应便于维护和升级，降低维护成本和风险。

### 3.1.2□整体架构图

PetFosterHub宠物寄养平台的整体架构图如图3-1所示：

图3-1□PetFosterHub宠物寄养平台整体架构图

（注：整体架构图应包含前端、后端、数据层、第三方服务等部分，以及各部分之间的交互关系。由于这里无法直接绘制图形，具体架构图将在实际论文中展示。）

## 3.2□技术栈选型

根据系统的需求和架构设计原则，选择合适的技术栈是确保系统性能、可靠性和可扩展性的关键。PetFosterHub宠物寄养平台的技术栈选型如下：

### 3.2.1□后端技术栈

1. 开发框架：Spring Boot 2.7.x
   Spring Boot是一个轻量级的Java开发框架，它简化了Spring应用的开发过程，提供了自动配置、内嵌容器等特性，能够快速搭建独立的、生产级别的Spring应用。

2. ORM框架：MyBatis-Plus 3.x
   MyBatis-Plus是MyBatis的增强工具，它在MyBatis的基础上增加了许多实用的功能，如自动生成CRUD代码、分页插件、性能分析插件等，能够提高开发效率和代码质量。

3. 数据库：MySQL 8.0
   MySQL是一个开源的关系型数据库管理系统，它具有高性能、高可靠性、易使用等优点，是当前最流行的数据库之一，适合存储结构化数据。

4. 缓存：Redis 6.0
   Redis是一个开源的内存数据结构存储系统，它可以用作数据库、缓存和消息中间件。Redis具有高性能、高可用性、支持多种数据结构等优点，适合存储热点数据、会话数据等。

5. 搜索引擎：Elasticsearch 7.x
   Elasticsearch是一个开源的分布式搜索引擎，它具有高性能、高可用性、支持全文检索、多字段查询等优点，适合用于寄养服务的搜索和筛选功能。

6. 消息队列：RabbitMQ
   RabbitMQ是一个开源的消息队列中间件，它具有高可靠性、支持多种协议、灵活的路由等优点，适合用于异步通信、解耦系统组件等场景。

7. 认证授权：Spring Security + JWT
   Spring Security是一个功能强大的安全框架，它提供了认证、授权、攻击防护等功能。JWT（JSON Web Token）是一种用于安全传输信息的简洁的、自包含的方式，适合用于前后端分离架构中的认证授权。

8. 日志框架：SLF4J + Logback
   SLF4J是一个日志门面，它提供了统一的日志接口。Logback是一个高性能的日志实现，它是Log4j的改进版本，提供了更多的功能和更好的性能。

9. API文档：Swagger/OpenAPI
   Swagger/OpenAPI是一个用于描述、生产、消费和可视化RESTful API的规范和工具，它能够自动生成API文档，方便前端开发人员和测试人员了解和使用API。

### 3.2.2□前端技术栈

1. 前端框架：Vue.js 3.x + Vite
   Vue.js是一个渐进式JavaScript框架，它易于上手，性能出色，适合构建用户界面。Vue.js 3.x是Vue.js的最新版本，它带来了许多新特性和性能改进。Vite是一个现代的前端构建工具，它提供了快速的开发服务器和优化的构建输出。

2. 状态管理：Pinia
   Pinia是Vue.js的官方状态管理库，它是Vuex的替代品，提供了更简洁的API、更好的TypeScript支持和更好的性能。

3. UI组件库：Element Plus
   Element Plus是一套基于Vue.js 3.x的桌面端UI组件库，它提供了丰富的组件和样式，能够快速构建美观、易用的用户界面。

4. 路由管理：Vue Router 4.x
   Vue Router是Vue.js的官方路由管理器，它能够帮助开发者构建单页应用，实现页面的跳转和参数传递。

5. HTTP客户端：Axios
   Axios是一个基于Promise的HTTP客户端，它能够用于浏览器和Node.js环境，支持请求和响应拦截、取消请求、转换数据等功能。

6. CSS预处理器：SCSS/Tailwind CSS
   SCSS是CSS的预处理器，它扩展了CSS的功能，提供了变量、嵌套、混合等特性，使CSS的编写更加高效和可维护。Tailwind CSS是一个实用工具优先的CSS框架，它提供了大量的预定义类，能够快速构建自定义的用户界面。

### 3.2.3□移动端技术栈

1. 开发框架：Flutter 3.x
   Flutter是Google开发的开源UI工具包，它能够帮助开发者使用一套代码构建跨平台的移动应用（iOS、Android），提供了原生的性能和外观。

2. 状态管理：Provider + GetX
   Provider是Flutter官方推荐的状态管理库，它简单易用，适合中小型应用。GetX是一个功能强大的Flutter框架，它提供了状态管理、路由管理、依赖注入等功能，适合复杂应用的开发。

### 3.2.4□基础设施与部署

1. 容器化：Docker
   Docker是一个开源的容器化平台，它能够将应用程序及其依赖打包成一个容器，实现应用的快速部署、测试和扩展。

2. 容器编排：Kubernetes
   Kubernetes是一个开源的容器编排平台，它能够自动化容器的部署、扩展和管理，提供了高可用性、负载均衡、滚动更新等功能。

3. CI/CD：Jenkins + GitLab CI
   Jenkins和GitLab CI都是开源的持续集成和持续部署工具，它们能够自动化代码的构建、测试和部署过程，提高开发效率和代码质量。

4. 监控与告警：Prometheus + Grafana
   Prometheus是一个开源的监控和告警工具，它能够收集和存储系统的监控数据。Grafana是一个开源的数据可视化工具，它能够将Prometheus收集的数据以图表的形式展示出来，方便用户查看和分析。

## 3.3□系统分层设计

PetFosterHub宠物寄养平台的后端系统采用分层设计，将系统分为接入层、应用层、数据层和基础设施层四个主要层次。各层的职责和功能如下：

### 3.3.1□接入层

接入层是系统的入口，主要负责接收和处理用户的请求，包括API网关、负载均衡、认证授权等功能。具体职责如下：

1. API网关：统一管理和路由所有的API请求，提供请求转发、负载均衡、限流、熔断等功能。
2. 负载均衡：将用户的请求分发到多个后端服务器，提高系统的吞吐量和可用性。
3. 认证授权：验证用户的身份和权限，确保只有授权的用户能够访问系统的资源。
4. 请求过滤：过滤和验证用户的请求，防止非法请求和恶意攻击。
5. 日志记录：记录用户的请求日志，便于问题追溯和系统监控。

### 3.3.2□应用层

应用层是系统的核心，主要负责业务逻辑的处理和实现，包括各种微服务模块。具体职责如下：

1. 业务逻辑处理：实现系统的各种业务逻辑，如用户管理、宠物管理、寄养服务管理、订单管理等。
2. 服务编排：协调多个微服务之间的调用和交互，完成复杂的业务流程。
3. 数据转换：将数据层的数据转换为前端需要的格式，或将前端的请求数据转换为数据层需要的格式。
4. 事务管理：确保业务操作的原子性、一致性、隔离性和持久性。
5. 异常处理：处理系统运行过程中出现的异常，提供友好的错误提示和日志记录。

应用层采用微服务架构，将系统拆分为多个独立的微服务模块，每个模块负责特定的业务功能。主要的微服务模块包括：

1. 用户服务：负责用户的注册、登录、个人信息管理、实名认证等功能。
2. 宠物服务：负责宠物信息的添加、修改、删除、查询等功能。
3. 寄养服务：负责寄养服务的发布、管理、搜索、筛选等功能。
4. 订单服务：负责订单的创建、支付、处理、查询等功能。
5. 消息服务：负责消息的发送、接收、存储等功能。
6. 支付服务：负责支付的处理、退款、查询等功能。
7. 评价服务：负责评价的发布、查询、统计等功能。
8. 搜索服务：负责寄养服务的搜索和筛选功能。

### 3.3.3□数据层

数据层主要负责数据的存储和管理，包括数据库、缓存、文件存储、搜索引擎等。具体职责如下：

1. 数据存储：将应用层处理后的数据存储到数据库、缓存、文件存储、搜索引擎等中。
2. 数据访问：提供数据的查询、插入、更新、删除等操作的接口。
3. 数据一致性：确保多个数据源之间的数据一致性。
4. 数据备份与恢复：定期对数据进行备份，并制定完善的数据恢复策略。
5. 数据安全：确保数据的安全和隐私，防止数据泄露和篡改。

数据层的主要组件包括：

1. MySQL数据库：存储结构化数据，如用户信息、宠物信息、订单信息等。
2. Redis缓存：存储热点数据、会话数据等，提高数据的访问速度。
3. 文件存储：存储用户上传的图片、视频等文件，如宠物照片、寄养环境照片等。
4. Elasticsearch搜索引擎：存储和索引寄养服务信息，提供全文检索和多字段查询功能。

### 3.3.4□基础设施层

基础设施层主要负责为系统提供基础的运行环境和服务，包括服务器、网络、操作系统、中间件等。具体职责如下：

1. 服务器管理：管理和维护系统的服务器资源，确保服务器的稳定运行。
2. 网络管理：管理和维护系统的网络资源，确保网络的畅通和安全。
3. 操作系统管理：管理和维护系统的操作系统，确保操作系统的稳定运行和安全。
4. 中间件管理：管理和维护系统的中间件，如消息队列、缓存、搜索引擎等，确保中间件的稳定运行和性能。
5. 监控与告警：监控系统的运行状态和性能指标，及时发现和解决问题，并提供告警功能。

## 3.4□核心模块设计

本节将对PetFosterHub宠物寄养平台的核心模块进行详细设计，包括用户服务模块、宠物服务模块、寄养服务模块、订单服务模块、消息服务模块、支付服务模块、评价服务模块和搜索服务模块。

### 3.4.1□用户服务模块

用户服务模块是平台的基础模块，负责用户的注册、登录、个人信息管理、实名认证等功能。

1. 功能概述：
   - 用户注册：支持手机号、邮箱注册，需要进行验证码验证。
   - 用户登录：支持手机号/邮箱+密码登录，以及第三方账号登录。
   - 个人信息管理：用户可以查看和修改个人基本信息。
   - 实名认证：用户需要进行实名认证，认证通过后才能进行寄养服务发布或预订。
   - 账号安全：支持修改密码、绑定/解绑手机号和邮箱、查看登录日志等功能。

2. 关键类与接口：
   - UserController：处理用户相关的HTTP请求，如注册、登录、获取/修改个人信息等。
   - UserService：提供用户相关的业务逻辑，如用户注册、登录验证、个人信息更新等。
   - UserMapper：提供用户数据的访问接口，如查询用户、插入用户、更新用户等。
   - UserEntity：用户实体类，包含用户的基本信息字段。
   - AuthService：提供认证相关的服务，如生成JWT令牌、验证令牌等。
   - RealNameAuthService：提供实名认证相关的服务，如提交认证申请、审核认证信息等。

3. 数据模型：
   UserEntity类的主要字段包括：
   - id：用户ID，主键
   - username：用户名
   - password：密码（加密存储）
   - phone：手机号
   - email：邮箱
   - nickname：昵称
   - avatar：头像URL
   - gender：性别
   - birthday：生日
   - realNameStatus：实名认证状态（未认证、审核中、已认证、认证失败）
   - idCardNo：身份证号
   - realName：真实姓名
   - createTime：创建时间
   - updateTime：更新时间
   - lastLoginTime：最后登录时间
   - status：账号状态（正常、冻结）

4. 主要流程：
   - 用户注册流程：用户提交注册信息→系统验证信息→生成验证码→用户输入验证码→系统验证验证码→创建用户账号→注册成功。
   - 用户登录流程：用户提交登录信息→系统验证信息→生成JWT令牌→返回令牌→登录成功。
   - 实名认证流程：用户提交实名认证信息→系统验证信息→上传身份证照片→管理员审核→更新认证状态→认证完成。

### 3.4.2□宠物服务模块

宠物服务模块负责宠物主人管理自己宠物的信息。

1. 功能概述：
   - 添加宠物：宠物主人可以添加自己的宠物信息，并上传宠物照片。
   - 修改宠物：宠物主人可以修改已添加的宠物信息。
   - 删除宠物：宠物主人可以删除不需要的宠物信息。
   - 查询宠物：宠物主人可以查看自己所有宠物的列表和详情。
   - 宠物档案：为每只宠物建立电子档案，记录宠物的基本信息、健康状况、寄养历史等。

2. 关键类与接口：
   - PetController：处理宠物相关的HTTP请求，如添加、修改、删除、查询宠物等。
   - PetService：提供宠物相关的业务逻辑，如添加宠物、更新宠物信息、删除宠物等。
   - PetMapper：提供宠物数据的访问接口，如查询宠物、插入宠物、更新宠物、删除宠物等。
   - PetEntity：宠物实体类，包含宠物的基本信息字段。
   - PetFileService：提供宠物照片的上传、下载、删除等服务。

3. 数据模型：
   PetEntity类的主要字段包括：
   - id：宠物ID，主键
   - userId：所属用户ID
   - name：宠物名称
   - type：宠物类型（如猫、狗、其他）
   - breed：宠物品种
   - age：年龄
   - gender：性别
   - weight：体重
   - personality：性格特点
   - healthCondition：健康状况
   - vaccineStatus：疫苗接种情况
   - description：描述信息
   - createTime：创建时间
   - updateTime：更新时间

4. 主要流程：
   - 添加宠物流程：宠物主人提交宠物信息→系统验证信息→上传宠物照片→创建宠物记录→添加成功。
   - 查询宠物流程：宠物主人发送查询请求→系统验证用户权限→查询宠物信息→返回宠物列表或详情→查询成功。

### 3.4.3□寄养服务模块

寄养服务模块负责寄养家庭发布和管理寄养服务信息。

1. 功能概述：
   - 发布服务：寄养家庭可以发布寄养服务信息，并上传寄养环境照片。
   - 修改服务：寄养家庭可以修改已发布的服务信息。
   - 删除服务：寄养家庭可以删除已发布的服务信息。
   - 查询服务：寄养家庭可以查看自己发布的所有服务列表和详情。
   - 服务状态管理：寄养家庭可以设置服务的状态。
   - 搜索筛选：宠物主人可以根据地区、价格、服务类型、宠物类型等条件搜索和筛选寄养服务。

2. 关键类与接口：
   - FosterServiceController：处理寄养服务相关的HTTP请求，如发布、修改、删除、查询、搜索服务等。
   - FosterServiceService：提供寄养服务相关的业务逻辑，如发布服务、更新服务信息、删除服务、搜索服务等。
   - FosterServiceMapper：提供寄养服务数据的访问接口，如查询服务、插入服务、更新服务、删除服务等。
   - FosterServiceEntity：寄养服务实体类，包含寄养服务的基本信息字段。
   - ServiceFileService：提供寄养环境照片的上传、下载、删除等服务。

3. 数据模型：
   FosterServiceEntity类的主要字段包括：
   - id：服务ID，主键
   - userId：所属用户ID（寄养家庭ID）
   - serviceType：服务类型（如日托、短期寄养、长期寄养）
   - price：服务价格
   - startTime：服务开始时间
   - endTime：服务结束时间
   - maxPetNum：可接受的最大宠物数量
   - acceptPetType：可接受的宠物类型
   - environmentDesc：寄养环境介绍
   - serviceFeature：服务特色
   - location：地理位置
   - contactInfo：联系方式
   - status：服务状态（可用、不可用、已预订）
   - createTime：创建时间
   - updateTime：更新时间

4. 主要流程：
   - 发布寄养服务流程：寄养家庭提交服务信息→系统验证信息→上传寄养环境照片→创建服务记录→发布成功。
   - 搜索寄养服务流程：宠物主人发送搜索请求→系统验证用户权限→根据搜索条件查询服务→返回服务列表→搜索成功。

### 3.4.4□订单服务模块

订单服务模块负责宠物主人和寄养家庭之间的订单交易流程。

1. 功能概述：
   - 创建订单：宠物主人选择寄养服务后，可以创建订单。
   - 支付订单：宠物主人创建订单后，需要在规定时间内完成支付。
   - 接单管理：寄养家庭可以查看待接单的订单，并决定是否接单。
   - 订单状态管理：支持订单状态的流转。
   - 订单详情查看：宠物主人和寄养家庭可以查看订单的详细信息。
   - 订单评价：订单完成后，宠物主人和寄养家庭可以互相评价。

2. 关键类与接口：
   - OrderController：处理订单相关的HTTP请求，如创建订单、支付订单、查看订单详情等。
   - OrderService：提供订单相关的业务逻辑，如创建订单、更新订单状态、查询订单等。
   - OrderMapper：提供订单数据的访问接口，如查询订单、插入订单、更新订单等。
   - OrderEntity：订单实体类，包含订单的基本信息字段。
   - PaymentService：提供支付相关的服务，如发起支付、查询支付结果等。

3. 数据模型：
   OrderEntity类的主要字段包括：
   - id：订单ID，主键
   - orderNo：订单编号
   - userId：用户ID（宠物主人ID）
   - fosterUserId：寄养家庭ID
   - serviceId：寄养服务ID
   - petId：宠物ID
   - startDate：寄养开始日期
   - endDate：寄养结束日期
   - totalAmount：订单总金额
   - paymentStatus：支付状态（未支付、已支付、已退款）
   - orderStatus：订单状态（待支付、待接单、进行中、已完成、已取消、已退款）
   - specialRequest：特殊需求
   - createTime：创建时间
   - updateTime：更新时间
   - paymentTime：支付时间

4. 主要流程：
   - 创建订单流程：宠物主人选择寄养服务→填写订单信息→系统验证信息→创建订单→返回订单信息→创建成功。
   - 支付订单流程：宠物主人选择支付方式→发起支付请求→调用第三方支付接口→支付成功→更新订单状态→支付完成。

## 3.5□系统安全设计

系统安全是PetFosterHub宠物寄养平台设计的重要考虑因素，需要采取一系列措施确保系统的安全性和用户数据的隐私。系统安全设计主要包括以下几个方面：

### 3.5.1□认证与授权

1. JWT认证：采用JWT（JSON Web Token）进行用户认证，用户登录后生成JWT令牌，后续请求通过令牌进行身份验证。
2. RBAC权限模型：采用基于角色的访问控制（RBAC）模型，为不同的用户角色分配不同的权限，确保用户只能访问和操作其被授权的资源。
3. 密码加密：用户密码采用加盐哈希的方式进行加密存储，确保密码的安全。
4. 多因素认证：支持短信验证码、邮箱验证码等多因素认证方式，提高账号的安全性。

### 3.5.2□数据安全

1. 数据加密：对用户的敏感数据（如身份证号、手机号、银行卡号等）进行加密存储和传输，防止数据泄露和篡改。
2. 数据脱敏：在非必要的场景下，对用户的敏感数据进行脱敏处理，如手机号显示为138****1234。
3. 数据备份与恢复：定期对数据库进行备份，并制定完善的数据恢复策略，确保数据的安全和可用性。
4. 数据访问控制：实施严格的数据访问控制，确保只有授权的用户和系统组件能够访问数据。

### 3.5.3□接口安全

1. 接口认证：所有的API接口都需要进行认证，确保只有授权的用户能够访问接口。
2. 接口限流：对API接口进行限流，防止恶意请求和DDoS攻击。
3. 参数校验：对接口的输入参数进行严格的校验，防止SQL注入、XSS攻击等。
4. HTTPS传输：采用HTTPS协议进行数据传输，确保数据传输的安全性。
5. CORS配置：正确配置跨域资源共享（CORS），防止跨域攻击。

通过以上的系统架构设计，可以看出PetFosterHub宠物寄养平台的架构具有良好的可扩展性、可靠性、性能和安全性，能够满足系统的功能需求和非功能需求，为后续的系统实现提供了坚实的基础。